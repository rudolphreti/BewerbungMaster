@page "/"
@using BewerbungMasterApp.Components.Pages
@using BewerbungMasterApp.Components
@using BewerbungMasterApp.Interfaces
@using BewerbungMasterApp.Services
@inject JobEditService JobEditService
@inherits HomeBase
@rendermode InteractiveServer

<div class="container my-5" @onclick="JobEditService.ClearActiveEditField">
    <h3 class="text-center mb-4">Job Applications List</h3>

    @if (jobApplications == null)
    {
        <p class="text-center">Loading data...</p>
    }
    else if (jobApplications.Count == 0)
    {
        <p class="text-center">No applications available.</p>
    }
    else
    {
        <div class="table-responsive mx-auto" style="max-width: 100%;" @onclick:stopPropagation>
            <table class="table table-striped table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th scope="col" class="text-center">#</th>
                        <th scope="col" class="text-center col-4">Position</th>
                        <th scope="col" class="text-center col-3">Company</th>
                        <th scope="col" class="text-center">URL</th>
                        <th scope="col" class="text-center col-4">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int index = 0; index < jobApplications.Count; index++)
                    {
                        var job = jobApplications[index];
                        var currentIndex = index;
                        <tr>
                            <td class="text-center">@(index + 1)</td>
                            <HomeEdit Job="job"
                                      OnUpdate="RefreshList"
                                      IsEditingPosition="@JobEditService.IsEditingPosition(currentIndex)"
                                      IsEditingCompany="@JobEditService.IsEditingCompany(currentIndex)"
                                      OnStartEditing="(field) => JobEditService.SetActiveEditField(currentIndex, field)"
                                      OnStopEditing="JobEditService.ClearActiveEditField" />
                            <td class="text-center">
                                <a href="@job.URL" target="_blank" class="btn btn-primary btn-sm">Link</a>
                            </td>
                            <td class="text-center">
                                <HomeDelete Job="job" OnDelete="RefreshList" />
                                <HomeMoveDown Job="job" OnMove="RefreshList" />
                                <HomeMessage Job="job" />
                                <HomeFolder Job="job" />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>