@page "/"
@using BewerbungMasterApp.Components.Pages
@using BewerbungMasterApp.Components
@using BewerbungMasterApp.Interfaces
@using BewerbungMasterApp.Services
@using BewerbungMasterApp.Models
@inject JobEditService JobEditService
@inherits HomeBase
@rendermode InteractiveServer

<div class="container-fluid my-5" @onclick="JobEditService.ClearActiveEditField">
    <h3 class="text-center mb-4">Job Applications List</h3>

    <HomeRefreshButton OnRefreshCompleted="RefreshList" />
    <HomeAddJob OnJobAdded="RefreshList" />

    @if (jobApplications == null)
    {
        <p class="text-center">Loading data...</p>
    }
    else if (jobApplications.Count == 0)
    {
        <p class="text-center">No applications available.</p>
    }
    else
    {
        <div class="table-responsive mx-auto" style="max-width: 100%;" @onclick:stopPropagation>
            <table class="table table-striped table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th scope="col" class="text-center">#</th>
                        <th scope="col" class="text-center col-3">Position</th>
                        <th scope="col" class="text-center col-3">Company</th>
                        <th scope="col" class="text-center col-1">Type</th>
                        <th scope="col" class="text-center col-1">URL</th>
                        <th scope="col" class="text-center col-1">Path</th>
                        <th scope="col" class="text-center col-1">Actions</th>
                        <th scope="col" class="text-center col-3">Messages</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int index = 0; index < jobApplications.Count; index++)
                    {
                        var job = jobApplications[index];
                        var currentIndex = index;
                        <tr>
                            <td class="text-center">@(index + 1)</td>
                            <HomePosition Job="job" OnUpdate="RefreshList" />
                            <HomeCompany Job="job" OnUpdate="RefreshList" />
                            <HomeType Job="job" OnUpdate="RefreshList" JobAppContents="jobAppContents" />
                            <td class="text-center">
                                @* TODO: editable, new component *@
                                <a href="@job.URL" style="text-decoration: none" target="_blank">🔗</a>
                            </td>
                            <td class="text-center">
                                <HomeFolder Job="job" />
                            </td>
                            <td class="text-center">
                                <HomeDelete Job="job" OnDelete="RefreshList" />
                                <HomeMoveUpDown Job="job" OnMove="RefreshList" />
                            </td>
                            <td class="text-center">
                                <HomeMessage Job="job" />
                                <HomeCoverLetter Job="job" />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>